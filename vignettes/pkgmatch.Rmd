---
title: "The pkgmatch package"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{pkgmatch}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set (
    collapse = TRUE,
    comment = "#>"
)
```

The "pkgmatch" package is a search and matching engine for R packages. It finds
the best-matching R packages to an input of either a text description, or a
local path to an R package. `pkgmatch` was developed to enable rOpenSci to
identify similar packages to each new package submitted for [our software
peer-review scheme](https://ropensci.org/software-review/). By default, matches
are found from [rOpenSci's own package suite](https://ropensci.org/packages/),
but it is also possible to find matches from all [packages currently on
CRAN](https://cran.r-project.org).

## What does the package do?

What the package does is best understood by example:

```{r match-text-1}
library (pkgmatch)
pkgmatch_similar_pkgs ("Download open spatial data from NASA")
pkgmatch_similar_pkgs ("Efficient workflows for analyses of large scientific data sets")
```

The following lines find equivalent matches against all packages currently on
CRAN:

```{r match-text-1-cran}
library (pkgmatch)
pkgmatch_similar_pkgs ("Download open spatial data from NASA", corpus = "cran")
pkgmatch_similar_pkgs ("Efficient workflows for analyses of large scientific data sets", corpus = "cran")
```

As said, the package also accepts as input a path to a local R package. This
code downloads a "tarball" (`.tar.gz` file) from CRAN and finds matching
rOpenSci packages:

```{r odbc-ropensci-match}
u <- "https://cran.r-project.org/src/contrib/odbc_1.5.0.tar.gz"
destfile <- file.path (tempdir (), basename (u))
download.file (u, destfile = destfile)
pkgmatch_similar_pkgs (destfile)
```

We of course expect the best match against CRAN packages to be that package
itself:

```{r odbc-cran-match}
pkgmatch_similar_pkgs (destfile, corpus = "cran")
```

which it indeed is (noting that the package title is "RODBC"). As explained in
the documentation, the `pkgmatch_similar_pkgs()` function ranks final results
by combining several distinct results, primarily from Large Language Model
(LLM) embeddings, as well as from [more conventional document token-frequency
analyses](https://en.wikipedia.org/wiki/Okapi_BM25). The function includes an
additional `llm_proportion` parameter which can be used to weight the relative
contributions of these different inputs. Results from the LLM component are:

```{r odbc-cran-match-llm}
pkgmatch_similar_pkgs (destfile, corpus = "cran", llm_proportion = 1)
```

While results from other other component are:

```{r odbc-cran-match-bm25}
pkgmatch_similar_pkgs (destfile, corpus = "cran", llm_proportion = 0)
```

In this case, both are identical, which indicates that both approaches produce
reliably similar and reproducible results. The input passed to both functions
is in this case quite complex, in the form of an entire package. Results
between the two methods can differ notable for less precise inputs:

```{r text-match-llm}
library (pkgmatch)
pkgmatch_similar_pkgs ("Download open spatial data from NASA", llm_proportion = 1)
```

```{r text-match-bm25}
library (pkgmatch)
pkgmatch_similar_pkgs ("Download open spatial data from NASA", llm_proportion = 0)
```

```{r rm-odbc, echo = FALSE}
chk <- file.remove (destfile)
```
