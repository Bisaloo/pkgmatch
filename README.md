<!-- badges: start -->

[![R build
status](https://github.com/ropensci-review-tools/pkgsimil/workflows/R-CMD-check/badge.svg)](https://github.com/ropensci-review-tools/pkgsimil/actions?query=workflow%3AR-CMD-check)
[![codecov](https://codecov.io/gh/ropensci-review-tools/pkgsimil/branch/main/graph/badge.svg)](https://app.codecov.io/gh/ropensci-review-tools/pkgsimil)
[![Project Status:
Active](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)
<!-- badges: end -->

# pkgsimil

Similarity metrics between R packages, functions, or any code, based on
similarity of code, documentation, or both. Currently implements the
following metrics:

- `tree_similarity()` to measure similarity of syntax trees.

To start, the package needs to be loaded:

``` r
library (pkgsimil)
```

## Tree Similarity

The `tree_similarity()` function requires syntax trees as its main
parameters. These can be generated by the `tree_get()` function. This
function accepts a character vector of package names, and returns a
syntax tree for each package in [S-expression
form](https://en.wikipedia.org/wiki/S-expression), with each tree
represented by a single character string. The following code extracts
trees for two similar packages, [`pkgload`](https://pkgload.r-lib.org)
and [`pkgbuild`](https://pkgbuild.r-lib.org), with an obviously
different package, [`geodist`](https://hypertidy.github.io/geodist).

``` r
pkgs <- c ("pkgload", "pkgbuild", "geodist")
trees <- tree_get (pkgs, exported_only = TRUE)
sapply (trees, nchar)
```

    ##  pkgload pkgbuild  geodist 
    ##    19501    34100     6473

The individual trees are quite large, with generally tens of thousands
of characters. An example tree looks like this:

``` r
substring (unname (trees) [1], 1, 80)
```

    ## [1] "(((function)(parameters)((parameter)(dep_name)(parameter)(dep_ver)(default)(cont"

Note that that code used `exported_only = TRUE` to only return trees
corresponding to the exported functions of the packages. This generally
returns notably smaller trees, and so speeds up the following
comparisons. The default value of `FALSE` for that parameter should
generally be used, so that packages are compared in their entirety,
although that will generally take notably longer to calculate.

The trees can be compared with the `tree_similarity()` function:

``` r
tree_similarity (trees)
```

    ##   source_pkg dest_pkg source_tree_len dest_tree_len edit_dist tree_similarity
    ## 1    pkgload pkgbuild            2515          4460      3316       0.5245878
    ## 2    pkgload  geodist            2515           850      1981       0.4112927
    ## 3   pkgbuild  geodist            4460           850      3832       0.2783427

And as expected, the `pkgload` and `pkgbuild` packages are more similar
to one another than either is to `geodist`.
